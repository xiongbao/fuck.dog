smms={init:function(){$.fn.extend({insertAtCaret:function(t){var e,n,i,o=$(this)[0];document.selection?(this.focus(),sel=document.selection.createRange(),sel.text=t,this.focus(),$(this).focus()):o.selectionStart||"0"===o.selectionStart?(e=o.selectionStart,i=o.selectionEnd,n=o.scrollTop,i=o.value.substring(0,e)+t+o.value.substring(i,o.value.length),$(this).val(i),this.focus(),o.selectionStart=e+t.length,o.selectionEnd=e+t.length,o.scrollTop=n):($(this).val(this.val()+t),this.focus())}}),$("#zz-img-add").unbind("click").bind("click",function(t){$("#zz-img-file").click()}),$("#zz-img-file").change(function(){for(var t=0;t<this.files.length;t++){var e=this.files[t],n=new FormData;n.append("smfile",e),$.ajax({url:smms_url+"/action/multi-upload?do=upload",type:"POST",processData:!1,contentType:!1,data:n,dataType:"json",beforeSend:function(t){$("#zz-img-add .chevereto-pup-button-icon").hide(),$("#zz-img-add .chevereto-pup-button-text").text("upload...")},success:function(t){$("#zz-img-add .chevereto-pup-button-icon").show(),$("#zz-img-add .chevereto-pup-button-text").text("上传"),$("#zz-img-show").append('<img src="'+t.data.url+'" />'),"undefined"!=typeof comment_selector_&&0<$(comment_selector_).length&&$(comment_selector_).insertAtCaret('<img src="'+t.data.url+'" />');var e=$("input[data-addarea]");0<e.length&&(e.insertAtCaret(t.data.url),e.siblings("button").click())}})}})}},window.onload=smms.init();